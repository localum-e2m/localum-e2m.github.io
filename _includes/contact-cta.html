<!-- _includes/contact-cta.html -->
{% assign callout = site.footer.callout %}
{% assign contact_form_embed = site.forms.booking_google_form_url %}
<section class="footer-cta">
  <div class="container footer-cta__inner">
    <div class="footer-cta__info">
      <div class="footer-cta__content">
        {% if callout.eyebrow %}<p class="eyebrow">{{ callout.eyebrow }}</p>{% endif %}
        <h2>{{ callout.title }}</h2>
        {% if callout.subtitle %}<p class="muted">{{ callout.subtitle }}</p>{% endif %}
      </div>
      <ul class="footer-cta__contact">
        {% if site.contact.email %}
        <li>
          <span>Email</span>
          <a href="mailto:{{ site.contact.email }}">{{ site.contact.email }}</a>
        </li>
        {% endif %}
        {% if site.contact.phone %}
        {% assign phone_href = site.contact.phone | replace: ' ', '' | replace: '.', '' %}
        <li>
          <span>Téléphone</span>
          <a href="tel:{{ phone_href }}">{{ site.contact.phone }}</a>
        </li>
        {% endif %}
      </ul>
      {% if callout.button %}
      {% assign callout_href = callout.button.url %}
      {% unless callout.button.external %}
      {% assign callout_href = callout.button.url | relative_url %}
      {% endunless %}
      <div class="footer-cta__actions">
        <a
          class="button button--primary"
          href="{{ callout_href }}"
          data-contact-form-trigger
          {% if callout.button.external %}target="_blank" rel="noopener"{% endif %}>
          {{ callout.button.label }}
        </a>
      </div>
      {% endif %}
    </div>
    {% if contact_form_embed %}
    <div class="footer-cta__form" id="footer-contact-form" hidden aria-hidden="true">
      <iframe src="{{ contact_form_embed }}" title="Formulaire de contact" loading="lazy" allowfullscreen tabindex="-1"></iframe>
    </div>
    {% endif %}
  </div>
</section>
{% if contact_form_embed %}
<script>
  (function () {
    var trigger = document.querySelector('[data-contact-form-trigger]');
    var formWrapper = document.getElementById('footer-contact-form');
    if (!trigger || !formWrapper) {
      return;
    }

    var iframe = formWrapper.querySelector('iframe');
    var fallbackUrl = trigger.getAttribute('href');

    function revealForm() {
      if (formWrapper.classList.contains('is-visible')) {
        return;
      }

      formWrapper.removeAttribute('hidden');
      formWrapper.setAttribute('aria-hidden', 'false');

      if (iframe) {
        iframe.removeAttribute('tabindex');
      }

      requestAnimationFrame(function () {
        formWrapper.classList.add('is-visible');
      });

      setTimeout(function () {
        formWrapper.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 150);
    }

    trigger.addEventListener('click', function (event) {
      event.preventDefault();
      if (!formWrapper) {
        if (fallbackUrl) {
          window.location.href = fallbackUrl;
        }
        return;
      }
      revealForm();
    });

    if (window.location.hash === '#footer-contact-form') {
      revealForm();
    }
  })();
</script>
{% endif %}
